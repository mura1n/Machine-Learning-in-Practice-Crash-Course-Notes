# 第二章 机器学习问题的定义&泛化&度量

# 1. 如何去定义一个机器学习问题

想象一个实际的场景：某视频平台的主要收入是广告，在视频开始时会进行一次广告推荐，在视频播放到某一进度时广告会再次播放，用户观看广告的时间越长，视频平台通过广告获得的收益就越多。目标：平台需要在不影响用户体验的前提下通过广告赚取更多的钱。

- 预测目标target选择
    - 首先想到的是通过机器学习去预测点击率CTR (click to rate)，将其视作我们的预测目标target。但点击率通常并不能衡量用户对视频的喜爱程度和他们会观看视频的时间。（部分视频可能是”标题党”，即内容和标题并不符合，通过标题吸引大量观众，但观众不会在视频上停留较长时间）
    - 考虑到CTR可能存在的问题，我们考虑使用视频观看时长（watching time）作为新的预测目标target。视频观看的时间越长，可能用户对视频的内容更感兴趣，观看广告的时间也会更长。但视频观看时长最明显的短板是长短视频本身的时长就不相同，排名时存在“不公平”的现象。
    
    基于以上两点分析，最好是我们考虑对CTR和Watching time进行加权（trade-off）后的结果作为target。但为了方便课程推进，暂时用Watching time作为target。
    
- 监督学习问题还是非监督学习
    
    target是在预测阶段我们能够获取到的，所以可以认为是一个监督学习问题。
    
- 分类问题还是回归问题
    
    target是连续性的目标变量，所以这个问题是一个回归问题。
    
- 数据中是否存在模式/规律（patterns）
    - 每个人对不同的类型的视频都有各自的偏好
    - 爱好相同/专业相同的人可能会喜爱相同类型的视频
- 数据是否好获取？
    
    从用户的观看历史数据中获取我们所需要的数据即可。
    
- 评估标准（metrics/evaluation）是什么？
    
    目前使用均值平方误差(MSE, Mean Squared Error)
    
    $$
    \operatorname{MSE}(f, \boldsymbol{\theta})=\frac{1}{n} \sum_{i=1}^{n}\left(y_{i}-f\left(x_{i}, \boldsymbol{\theta}\right)\right)^{2}
    $$
    

# 2. 数据集的构建&特征工程

- 数据集构建目前主要将获取得到的用户历史观看数据划分为训练集和测试集，至于划分的解释包括是否引入验证集后续都会讲到。
- 哪些特征可能是有用的特征？
    - 从用户角度
        - 个人特征：年龄，性别，工作和收入等。
        - 地理位置：用户来自于哪个地方。
        - 观看历史（之前看过什么内容）
    - 从视频本身角度
        - 视频上传时间
        - 视频的内容（标题，封面和视频的时长等）
        - 观看视频的是哪些用户？
    - 视频链接的获取
        - 用户在什么时间搜索的这个视频？这个时间段热门视频是哪些？
        - 用户搜索的关键字。

# 3. 设计模型，模型训练及模型预测

- 在模型训练完成后，通常会用测试集进行测试预测，预测通常有两种方式（目前没有验证集这个概念出现，所以验证和测试目前算作同样的概念）：
    - 留一验证：将每一行样本数据称为一个记录，随机的选取一个记录作为预测数据，其它的记录作为训练数据，用训练数据训练好模型在预测数据上做预测。
        
        ![Untitled](%E7%AC%AC%E4%BA%8C%E7%AB%A0%20%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9A%E4%B9%89&%E6%B3%9B%E5%8C%96&%E5%BA%A6%E9%87%8F%20200cb7880e47424591a7cc48e54a192e/Untitled.png)
        
    - 考虑时间序列的验证：将数据分为最新的数据和过去的数据，所有过去的数据作为训练数据，最新的数据作为预测数据作预测。
    - 在本课程假设的这个例子上，选取留一验证是没有道理的，因为我们无法根据未来的数据预测过去的数据，这是荒唐的，所以我们考虑后一种验证方式。

# 4. 监督学习的一些评价准则

- 分类
    - 先介绍一下混淆矩阵（T/F: 预测是否正确，P/N：预测是正类还是负类）
        
        ![Untitled](%E7%AC%AC%E4%BA%8C%E7%AB%A0%20%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E9%97%AE%E9%A2%98%E7%9A%84%E5%AE%9A%E4%B9%89&%E6%B3%9B%E5%8C%96&%E5%BA%A6%E9%87%8F%20200cb7880e47424591a7cc48e54a192e/Untitled%201.png)
        
        - TP：预测为正类，实际为正类，预测正确。
        - FP：预测为正类，实际为负类，预测错误。
        - FN：预测为负类，实际为正类，预测错误。
        - TN：预测为负类，实际为负类，预测正确。
    - 准确率：正类和负类中预测正确的数量占总数量的占比。
        
        $$
        Accuracy=\frac{T P+T N}{T P+F P+F N+T N}
        $$
        
        - 存在问题1：准确率不可导，无法作为cost function去做训练，只能用作评估。
        - 存在问题2：正类和负类预测正确的重要性不一样，比如对于癌症检测来说，可能负类(没有患癌症) 预测正确的数量非常大，就导致Accuracy的分子非常大，得到的Accuracy就非常大，但是可能正类(患癌症) 预测正确的数量非常小，就导致虽然模型的准确率很高，但根本检测不出癌症。
        - 解决问题的方案：采用精确率或者召回率
            - 精确率：预测为正类的样本中预测正确的比例。
            
            $$
            precision=\frac{T P}{T P+F P}
            $$
            
            - 召回率：实际为正类的样本中，被预测正确的正类的比例。
        
        $$
        recall=\frac{T P}{T P+F N}
        $$
        
- 回归
    - MSE:
        
        $$
        \operatorname{MSE}(f, \boldsymbol{\theta})=\frac{1}{n} \sum_{i=1}^{n}\left(y_{i}-f\left(x_{i}, \boldsymbol{\theta}\right)\right)^{2}
        $$
        
    - MAE:
    
    $$
    \operatorname{MAE}(f, \boldsymbol{\theta})=\frac{1}{n}\left|y_{i}-f\left(x_{i}, \boldsymbol{\theta}\right)\right|
    $$
    
- Cost
    
    正常情况下是不会去考虑cost的，但是在实际应用场景中cost是一个非常重要的指标。比如内存开销，运行速度，运算平台，运行设备和模型训练所需要的数据等等。